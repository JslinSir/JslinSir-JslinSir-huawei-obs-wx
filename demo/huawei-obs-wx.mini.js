/*! For license information please see huawei-obs-wx.mini.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.huaweiObsWx=e():t.huaweiObsWx=e()}(self,(function(){return t={394:t=>{const e={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(t){var r,o,n,i,s,a,c,h="",u=0;for(t=e._utf8_encode(t);u<t.length;)i=(r=t.charCodeAt(u++))>>2,s=(3&r)<<4|(o=t.charCodeAt(u++))>>4,a=(15&o)<<2|(n=t.charCodeAt(u++))>>6,c=63&n,isNaN(o)?a=c=64:isNaN(n)&&(c=64),h=h+this._keyStr.charAt(i)+this._keyStr.charAt(s)+this._keyStr.charAt(a)+this._keyStr.charAt(c);return h},decode:function(t){var r,o,n,i,s,a,c="",h=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");h<t.length;)r=this._keyStr.indexOf(t.charAt(h++))<<2|(i=this._keyStr.indexOf(t.charAt(h++)))>>4,o=(15&i)<<4|(s=this._keyStr.indexOf(t.charAt(h++)))>>2,n=(3&s)<<6|(a=this._keyStr.indexOf(t.charAt(h++))),c+=String.fromCharCode(r),64!=s&&(c+=String.fromCharCode(o)),64!=a&&(c+=String.fromCharCode(n));return e._utf8_decode(c)},_utf8_encode:function(t){t=t.replace(/\r\n/g,"\n");for(var e="",r=0;r<t.length;r++){var o=t.charCodeAt(r);o<128?e+=String.fromCharCode(o):o>127&&o<2048?(e+=String.fromCharCode(o>>6|192),e+=String.fromCharCode(63&o|128)):(e+=String.fromCharCode(o>>12|224),e+=String.fromCharCode(o>>6&63|128),e+=String.fromCharCode(63&o|128))}return e},_utf8_decode:function(t){for(var e="",r=0,o=c1=c2=0;r<t.length;)(o=t.charCodeAt(r))<128?(e+=String.fromCharCode(o),r++):o>191&&o<224?(c2=t.charCodeAt(r+1),e+=String.fromCharCode((31&o)<<6|63&c2),r+=2):(c2=t.charCodeAt(r+1),c3=t.charCodeAt(r+2),e+=String.fromCharCode((15&o)<<12|(63&c2)<<6|63&c3),r+=3);return e}};t.exports=e},73:t=>{t.exports=new class{constructor(){this.AccessKeyId="",this.SecretKey="",this.SecurityToken="",this.EndPoint="",this.bucket="",this.Expiration="",this.FileUploadPath="",this.DomainUrl=""}setConfig({accessKeyId:t,secretKey:e,securityToken:r,bucket:o,endpoint:n,expiresAt:i,fileUploadPath:s,domainUrl:a}){this.AccessKeyId=t,this.SecretKey=e,this.SecurityToken=r,this.bucket=o;const c=`https://${o}.${n}`;this.EndPoint=c,this.Expiration=i,this.FileUploadPath=s,this.DomainUrl=a}}},662:(t,e,r)=>{r(890),r(177);const o=r(460);t.exports=function(t,e){const r=o.HMAC(o.SHA1,t,e,{asBytes:!0});return o.util.bytesToBase64(r)}},460:t=>{const e={};var r,o;r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=e.util={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&o.rotl(t,8)|4278255360&o.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=o.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")},stringToWords:function(t){for(var e=[],r=0,o=0;r<t.length;r++,o+=8)e[o>>>5]|=t.charCodeAt(r)<<24-o%32;return e},bytesToWords:function(t){for(var e=[],r=0,o=0;r<t.length;r++,o+=8)e[o>>>5]|=t[r]<<24-o%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){if("function"==typeof btoa)return btoa(o.bytesToString(t));for(var e,n=[],i=0;i<t.length;i++)switch(i%3){case 0:n.push(r.charAt(t[i]>>>2)),e=(3&t[i])<<4;break;case 1:n.push(r.charAt(e|t[i]>>>4)),e=(15&t[i])<<2;break;case 2:n.push(r.charAt(e|t[i]>>>6)),n.push(r.charAt(63&t[i])),e=-1}for(null!=e&&-1!=e&&n.push(r.charAt(e));n.length%4!=0;)n.push("=");return n.join("")},base64ToBytes:function(t){if("function"==typeof atob)return o.stringToBytes(atob(t));t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],n=0;n<t.length;n++)switch(n%4){case 1:e.push(r.indexOf(t.charAt(n-1))<<2|r.indexOf(t.charAt(n))>>>4);break;case 2:e.push((15&r.indexOf(t.charAt(n-1)))<<4|r.indexOf(t.charAt(n))>>>2);break;case 3:e.push((3&r.indexOf(t.charAt(n-1)))<<6|r.indexOf(t.charAt(n)))}return e}},e.mode={},t.exports=e},307:(t,e,r)=>{const o=r(394);t.exports=function(t){return o.encode(JSON.stringify(t))}},890:(t,e,r)=>{const o=r(460);var n;n=o.util,o.HMAC=function(t,e,r,o){for(var i=r=r.length>4*t._blocksize?t(r,{asBytes:!0}):n.stringToBytes(r),s=r.slice(0),a=0;a<4*t._blocksize;a++)i[a]^=92,s[a]^=54;var c=t(n.bytesToString(i)+t(n.bytesToString(s)+e,{asString:!0}),{asBytes:!0});return o&&o.asBytes?c:o&&o.asString?n.bytesToString(c):n.bytesToHex(c)},t.exports=o},431:(t,e,r)=>{const o=r(73),n=r(307),i=r(662);t.exports={OBSupload:function(t,e){return t?((t,e)=>{const r=t.split("."),s=r[r.length-1],a=`image/${s}`;let c=e||"picture-mini";c=`${c}-${Date.now()}.${s}`;const h={expiration:o.Expiration,conditions:[{bucket:o.bucket},{"x-obs-security-token":o.SecurityToken},{"content-type":a},{"x-obs-acl":"public-read"},{key:`${o.FileUploadPath}${c}`}]},u=n(h),f=i(u,o.SecretKey);return new Promise(((e,r)=>{wx.uploadFile({url:o.EndPoint,filePath:t,name:"file",header:{"content-type":"multipart/form-data; boundary=-9431149156168"},formData:{AccessKeyID:o.AccessKeyId,policy:u,signature:f,"x-obs-security-token":o.SecurityToken,"content-type":a,"x-obs-acl":"public-read",key:`${o.FileUploadPath}${c}`},success:function(t){if("204"==t.statusCode){const t=o.DomainUrl,r=t.endsWith("/")?"":"/",n=`${o.DomainUrl}${r}${o.FileUploadPath}${c}`,i=`${o.FileUploadPath}${c}`;e({url:n,path:i,domainUrl:t}),console.log("上传图片成功: url:",n,"path:",i)}else console.log("上传图片失败",t),r(t)},fail:function(t){console.log("上传图片失败",t),r(t)}})}))})(t,e):(wx.showToast({title:"文件路径不能为空",icon:"none"}),!1)},setObsConfig:t=>{o.setConfig(t)}}},177:(t,e,r)=>{const o=r(460);var n,i;n=o.util,(i=o.SHA1=function(t,e){var r=n.wordsToBytes(i._sha1(t));return e&&e.asBytes?r:e&&e.asString?n.bytesToString(r):n.bytesToHex(r)})._sha1=function(t){var e=n.stringToWords(t),r=8*t.length,o=[],i=1732584193,s=-271733879,a=-1732584194,c=271733878,h=-1009589776;e[r>>5]|=128<<24-r%32,e[15+(r+64>>>9<<4)]=r;for(var u=0;u<e.length;u+=16){for(var f=i,d=s,l=a,p=c,y=h,g=0;g<80;g++){if(g<16)o[g]=e[u+g];else{var b=o[g-3]^o[g-8]^o[g-14]^o[g-16];o[g]=b<<1|b>>>31}var S=(i<<5|i>>>27)+h+(o[g]>>>0)+(g<20?1518500249+(s&a|~s&c):g<40?1859775393+(s^a^c):g<60?(s&a|s&c|a&c)-1894007588:(s^a^c)-899497514);h=c,c=a,a=s<<30|s>>>2,s=i,i=S}i+=f,s+=d,a+=l,c+=p,h+=y}return[i,s,a,c,h]},i._blocksize=16,t.exports=o}},e={},function r(o){var n=e[o];if(void 0!==n)return n.exports;var i=e[o]={exports:{}};return t[o](i,i.exports,r),i.exports}(431);var t,e}));